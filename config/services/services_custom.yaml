services:
    # Service Twig Environment
    Twig\Environment:
        class: Twig\Environment
        arguments:
            - '@twig.loader'
            - []
        public: true

    twig.loader:
        class: Twig\Loader\FilesystemLoader
        arguments:
            - '%kernel.project_dir%/Views/templates'
        public: true

    TCPDF:
        class: TCPDF
        public: false

    App\Service\genererPdf\HeaderFooterAcPdf:
        class: App\Service\genererPdf\HeaderFooterAcPdf
        public: false

    PHPMailer\PHPMailer\PHPMailer:
        class: PHPMailer\PHPMailer\PHPMailer
        public: false # C'est une dépendance, pas besoin de le rendre public

    App\Service\TwigMailerService:
        arguments:
            $phpMailer: '@PHPMailer\PHPMailer\PHPMailer' # Assumes PHPMailer is registered as a service
            $twigEnvironment: '@Twig\Environment'
            $assetFolder: '%kernel.project_dir%/public'

    App\Service\EmailService:
        class: App\Service\EmailService
        arguments:
            $twig: '@Twig\Environment'
            $mailerHost: '%env(MAILER_HOST)%'
            $mailerUser: '%env(MAILER_USER)%'
            $mailerPass: '%env(MAILER_PASSWORD)%'
            $mailerPort: '%env(MAILER_PORT)%'
            $fromEmail: '%env(MAILER_FROM_EMAIL)%'
            $fromName: '%env(MAILER_FROM_NAME)%'
            $bccRecipients: 
                - 'ranofimenjajam@gmail.com'
                - 'hasina.andrianadison@hff.mg'

    # Services spécifiques
    App\Service\ExcelService:
        public: true

    App\Service\FusionPdf:
        arguments:
            $fpdi: '@setasign\Fpdi\Tcpdf\Fpdi'
        public: true

    App\Service\SessionManagerService:
        arguments:
            $session: '@session'
        public: true

    App\Model\LdapModel:
        class: App\Model\LdapModel
        arguments:
            $ldapHost: '%env(LDAP_HOST)%'
            $ldapPort: '%env(LDAP_PORT)%'
            $domain: '%env(LDAP_DOMAIN)%'
            $ldapDn: '%env(LDAP_DN)%'
            $logger: '@App\Service\AppLogger'
        public: true

    # Services de connexion aux bases de données
    App\Model\Connexion:
        class: App\Model\Connexion
        arguments:
            $dbDns: '%odbc.main.dsn%'
            $dbUsername: '%odbc.main.user%'
            $dbPassword: '%odbc.main.password%'
            $logger: '@App\Service\AppLogger'
        public: true

    App\Service\AppLogger:
        class: App\Service\AppLogger
        arguments:
            $logFilePath: '%env(BASE_PATH_LOG)%'
        public: true

    App\Service\DoctrineOdbcWrapper:
        class: App\Service\DoctrineOdbcWrapper
        arguments:
            $entityManager: '@doctrine.orm.default_entity_manager'
            $connexion: '@App\Model\Connexion'
            $connexionDote4: '@App\Model\ConnexionDote4'
            $connexionDote4Gcot: '@App\Model\ConnexionDote4Gcot'
            $connexionInformix: '@App\Model\DatabaseInformix'
        public: true

    App\Model\ConnexionDote4:
        class: App\Model\ConnexionDote4
        arguments:
            $dbDns: '%odbc.dote4.dsn%'
            $dbUsername: '%odbc.dote4.user%'
            $dbPassword: '%odbc.dote4.password%'
            $logger: '@App\Service\AppLogger'
        public: true

    App\Model\ConnexionDote4Gcot:
        class: App\Model\ConnexionDote4Gcot
        arguments:
            $dbDns: '%odbc.dote4gc.dsn%'
            $dbUsername: '%odbc.dote4gc.user%'
            $dbPassword: '%odbc.dote4gc.password%'
            $logger: '@App\Service\AppLogger'
        public: true

    App\Model\DatabaseInformix:
        class: App\Model\DatabaseInformix
        arguments:
            $dsn: '%odbc.informix.dsn%'
            $user: '%odbc.informix.user%'
            $password: '%odbc.informix.password%'
            $logger: '@App\Service\AppLogger'
        public: true

    # Services de navigation
    App\Service\navigation\MenuService:
        class: App\Service\navigation\MenuService
        autowire: false
        arguments:
            - '@doctrine.orm.default_entity_manager'
            - '@App\Service\SessionManagerService'
            - '/Hffintranet'
        public: true

    App\Service\navigation\BreadcrumbMenuService:
        autowire: false
        arguments:
            - '@App\Service\navigation\MenuService'
        public: true

    App\Service\historiqueOperation\HistoriqueOperationDevisMagasinService:
        arguments:
            - '@doctrine.orm.default_entity_manager'
            - '@App\Service\SessionManagerService'
        public: true

    # ✅ NOUVELLES CONFIGURATIONS - Ajouter à la fin du fichier
    # Services problématiques qui nécessitent une configuration
    App\Service\genererPdf\GeneratePdfDevisMagasin:
        class: App\Service\genererPdf\GeneratePdfDevisMagasin
        arguments:
            $baseCheminDuFichier: '%env(BASE_PATH_FICHIER)%'
        public: true





    # Services avec injection de dépendance corrigée
    App\Service\AncienDitService:
        arguments:
            $em: '@doctrine.orm.default_entity_manager'
            $ditModel: '@App\Model\dit\DitModel'
            $genererPdfDit: '@App\Service\genererPdf\GenererPdfDit'
            $fusionPdf: '@App\Service\FusionPdf'
        public: true


    # Service FPDI pour la fusion de PDF
    setasign\Fpdi\Tcpdf\Fpdi:
        class: setasign\Fpdi\Tcpdf\Fpdi
        public: false

    # Service JsonFileService - configuration explicite pour éviter l'autowiring
    App\Service\fichier\JsonFileService:
        arguments:
            $filePath: '%kernel.project_dir%/var/cache/data.json'
        public: false

    # Service HeaderPdf - configuration explicite pour éviter l'autowiring
    App\Service\genererPdf\HeaderPdf:
        arguments:
            $email: 'noreply@example.com'
        public: false

    # Service DevisMagasinValidationVdService - configuration explicite pour éviter l'autowiring
    App\Service\magasin\devis\DevisMagasinValidationVdService:
        arguments:
            $expectedNumeroDevis: 'DEV'
        public: false

    # Service DevisMagasinValidationVpService - configuration explicite pour éviter l'autowiring
    App\Service\magasin\devis\DevisMagasinValidationVpService:
        arguments:
            $expectedNumeroDevis: 'DEV'
        public: false

    # Service FileReaderModel - configuration explicite pour éviter l'autowiring
    App\Model\FileReaderModel:
        arguments:
            $filePath: '%kernel.project_dir%/var/cache/'
        public: false


    # Repository AgenceRepository - configuration explicite pour éviter l'autowiring
    App\Repository\admin\AgenceRepository:
        arguments:
            $em: '@doctrine.orm.default_entity_manager'
            $class: 'App\Entity\admin\Agence'
        public: false

    # Repository ApplicationRepository - configuration explicite pour éviter l'autowiring
    App\Repository\admin\ApplicationRepository:
        arguments:
            $em: '@doctrine.orm.default_entity_manager'
            $class: 'App\Entity\admin\Application'
        public: false

    # Repository PersonnelRepository - configuration explicite pour éviter l'autowiring
    App\Repository\admin\PersonnelRepository:
        arguments:
            $em: '@doctrine.orm.default_entity_manager'
            $class: 'App\Entity\admin\Personnel'
        public: false

    # Repository ServiceRepository - configuration explicite pour éviter l'autowiring
    App\Repository\admin\ServiceRepository:
        arguments:
            $em: '@doctrine.orm.default_entity_manager'
            $class: 'App\Entity\admin\Service'
        public: false

    # Form PlanningSearchType - configuration explicite pour l'injection de dépendances
    App\Form\planning\PlanningSearchType:
        arguments:
            $planningModel: '@App\Model\planning\PlanningModel'
        public: true

    # Form MagasinListeOrATraiterSearchType - configuration explicite pour l'injection de dépendances
    App\Form\magasin\MagasinListeOrATraiterSearchType:
        arguments:
            $magasinModel: '@App\Model\magasin\MagasinListeOrATraiterModel'
        public: true

    # Form MagasinListeOrALivrerSearchType - configuration explicite pour l'injection de dépendances
    App\Form\magasin\MagasinListeOrALivrerSearchType:
        arguments:
            $magasinModel: '@App\Model\magasin\MagasinListeOrLivrerModel'
        public: true

    # Form ATraiterSearchType - configuration explicite pour l'injection de dépendances
    App\Form\magasin\cis\ATraiterSearchType:
        arguments:
            $magasinModel: '@App\Model\magasin\MagasinListeOrATraiterModel'
        public: true

    # Form ALivrerSearchType - configuration explicite pour l'injection de dépendances
    App\Form\magasin\cis\ALivrerSearchType:
        arguments:
            $magasinModel: '@App\Model\magasin\MagasinListeOrLivrerModel'
        public: true

    # Form ALivrerSearchtype - configuration explicite pour l'injection de dépendances (avec casse différente)
    App\Form\magasin\cis\ALivrerSearchtype:
        arguments:
            $magasinModel: '@App\Model\magasin\MagasinListeOrLivrerModel'
        public: true

    # Services avec paramètres primitifs - configuration explicite pour éviter l'autowiring
    App\Service\fichier\FileUploaderService:
        class: App\Service\fichier\FileUploaderService
        arguments:
            $targetDirectory: '%env(BASE_PATH_FICHIER)%'

    App\Service\docuware\CopyDocuwareService:
        public: true

    App\Service\fichier\UploderFileService:
        arguments:
            $cheminDeBase: '%kernel.project_dir%/public/uploads'
        public: false

    # Service de sécurité pour la gestion des autorisations
    App\Service\security\SecurityService:
        arguments:
            $sessionService: '@App\Service\SessionManagerService'
            $authorizationChecker: '@security.authorization_checker'
        public: true

    # Voter pour les autorisations d'application
    App\Security\Voter\ApplicationVoter:
        tags: ['security.voter']
        public: false

    App\Service\da\FileUploaderForDAService:
        class: App\Service\da\FileUploaderForDAService
        arguments:
            $basePath: '%env(BASE_PATH_LONG)%/public/uploads/da'
        public: true

    App\Service\da\EmailDaService:
        class: App\Service\da\EmailDaService
        arguments:
            $emailService: '@App\Service\EmailService'
        public: true

    App\Service\genererPdf\GenererPdfDit:
        class: App\Service\genererPdf\GenererPdfDit
        arguments:
            $tcpdf: '@TCPDF'
            $baseCheminDuFichier: '%env(BASE_PATH_FICHIER)%'
        public: false

    App\Factory\BreadcrumbFactory:
        arguments:
            $baseUrl: '/'
            $breadcrumbMenuService: '@App\Service\navigation\BreadcrumbMenuService'
        public: false


    # Configuration générique pour tous les repositories - désactiver l'autowiring
    App\Repository\:
        resource: '../src/Repository/*'
        autowire: false
        public: true

    # Service HandleRequestService avec injection de dépendance corrigée
    App\Service\tik\HandleRequestService:
        arguments:
            $em: '@doctrine.orm.default_entity_manager'
            $twig: '@Twig\Environment'
            $emailTikService: '@App\Service\tik\EmailTikService'
            $sessionService: '@App\Service\SessionManagerService'
        public: true

    

    # DomModel - configuration avec autowiring
    App\Model\dom\DomModel:
        autowire: true
        autoconfigure: true
        public: false


    # Service EmailTikService
    App\Service\tik\EmailTikService:
        arguments:
            $em: '@doctrine.orm.default_entity_manager'
            $twig: '@Twig\Environment'
            $emailService: '@App\Service\EmailService'
        public: true

    # AppExtension Twig avec injection du conteneur
    App\Twig\AppExtension:
        arguments:
            $container: '@service_container'
        public: false

    # Service HistoriqueOperationService avec injection de dépendance corrigée
    App\Service\historiqueOperation\HistoriqueOperationService:
        arguments:
            $em: '@doctrine.orm.default_entity_manager'
            $sessionService: '@App\Service\SessionManagerService'
            $typeDocumentId: 1 # Valeur par défaut, peut être surchargée
        public: true

    # Formulaires avec injection de dépendance corrigée
    App\Form\tik\DetailTikType:
        arguments:
            $em: '@doctrine.orm.default_entity_manager'
            $sessionService: '@App\Service\SessionManagerService'
        public: true

    App\Form\admin\utilisateur\UserType:
        arguments:
            $em: '@doctrine.orm.default_entity_manager'
            $ldap: '@App\Model\LdapModel'
            $sessionService: '@App\Service\SessionManagerService'
        public: true

    # Modèles avec autowiring Symfony
    App\Model\Model:
        arguments:
            $connexion: '@App\Model\Connexion'
            $connect: '@App\Model\DatabaseInformix'
            $connexion04: '@App\Model\ConnexionDote4'
            $connexion04Gcot: '@App\Model\ConnexionDote4Gcot'
        public: true

    # Configuration générique pour tous les modèles qui héritent de Model
    App\Model\:
        resource: '../src/Model/*'
        arguments:
            $connexion: '@App\Model\Connexion'
            $connect: '@App\Model\DatabaseInformix'
            $connexion04: '@App\Model\ConnexionDote4'
            $connexion04Gcot: '@App\Model\ConnexionDote4Gcot'
        public: true
        exclude:
            - '../src/Model/Model.php'
            - '../src/Model/Connexion.php'
            - '../src/Model/DatabaseInformix.php'
            - '../src/Model/ConnexionDote4.php'
            - '../src/Model/ConnexionDote4Gcot.php'
            - '../src/Model/LdapModel.php'
            - '../src/Model/FileReaderModel.php'
            - '../src/Model/dit/RequestSoumisValidation.php'

    # Le contrôleur ListeDevisMagasinController n'a plus besoin de configuration spécifique
    # car il utilise le service container pour récupérer ses dépendances

    # Configuration explicite pour DossierInterventionAtelierModel
    App\Model\dw\DossierInterventionAtelierModel:
        arguments:
            $connexion: '@App\Model\Connexion'
            $connect: '@App\Model\DatabaseInformix'
            $connexion04: '@App\Model\ConnexionDote4'
            $connexion04Gcot: '@App\Model\ConnexionDote4Gcot'
        public: true

    App\Controller\Authentification:
        class: App\Controller\Authentification
        arguments:
            $ldapModel: '@App\Model\LdapModel'
            $authCsvFilePath: '%env(BASE_PATH_LONG)%/src/Controller/authentification.csv'
            $emailDaService: '@App\Service\da\EmailDaService'
            $daFileUploader: '@App\Service\da\FileUploaderForDAService'
            $daAfficherRepository: null
            $demandeApproRepository: null
            $demandeApproLRepository: null
            $demandeApproLRRepository: null
        autowire: false
        autoconfigure: false
        tags: ['controller.service_arguments']
        public: true

    # Services pour InventaireController
    App\Model\inventaire\InventaireModel:
        arguments:
            $connexion: '@App\Model\Connexion'
            $connect: '@App\Model\DatabaseInformix'
            $connexion04: '@App\Model\ConnexionDote4'
            $connexion04Gcot: '@App\Model\ConnexionDote4Gcot'
        public: true

    App\Service\genererPdf\GeneretePdfInventaire:
        arguments:
            $baseCheminDuFichier: '%upload_directory%'
        public: true

    App\Service\genererPdf\GeneretePdfBordereau:
        arguments:
            $baseCheminDuFichier: '%upload_directory%'
        public: true

    # Formulaires avec injection de dépendances
    App\Form\inventaire\InventaireSearchType:
        arguments:
            $inventaireModel: '@App\Model\inventaire\InventaireModel'
        public: true

    App\Form\inventaire\detailInventaireSearchType:
        arguments:
            $inventaireModel: '@App\Model\inventaire\InventaireModel'
        public: true

    App\Form\magasin\lcfnp\ListeCdeFrnNonPlaceSearchType:
        arguments:
            $magasinModel: '@App\Model\magasin\MagasinListeOrATraiterModel'
        public: true

