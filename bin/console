#!/usr/bin/env php
<?php

require dirname(__DIR__) . DIRECTORY_SEPARATOR . 'vendor/autoload.php';
require_once dirname(__DIR__) . '/config/dotenv.php';
$entitymanager = require_once dirname(__DIR__) . "/doctrineBootstrap.php";

use App\Command\AncienDitCommand;
use App\Command\cache\CacheWarmupAgServCommand;
use App\Command\cache\CacheWarmupSecurityCommand;
use App\Command\cache\CacheWarmupMenuCommand;
use App\Command\MigrationPdfCommand;
use App\Command\MigrationDataCommand;
use App\Command\MigrationDevisCommand;
use Symfony\Component\Console\Application;
use App\Command\magasin\MigrationPdfDevisMagasinVdCommand;
use App\Command\magasin\MigrationPdfDevisMagasinVpCommand;
use App\Service\navigation\MenuService;
use App\Service\UserData\UserDataService;
use Symfony\Component\Cache\Adapter\FilesystemTagAwareAdapter;

// Ajouter la commande à l'application Symfony Console
$application = new Application();
$application->add(new AncienDitCommand($entityManager));
$application->add(new MigrationPdfCommand($entityManager));
$application->add(new MigrationDataCommand($entityManager));
$application->add(new MigrationDevisCommand());
$application->add(new MigrationPdfDevisMagasinVpCommand($entitymanager));
$application->add(new MigrationPdfDevisMagasinVdCommand($entitymanager));

$cachePermissions = new FilesystemTagAwareAdapter('security', 3600, dirname(__DIR__) . '/var/cache/pools');
$userDataService = new UserDataService($entityManager, $cachePermissions);
$application->add(new CacheWarmupSecurityCommand($entityManager, $userDataService));
$application->add(new CacheWarmupAgServCommand($entityManager, $userDataService));

$cacheMenu = new FilesystemTagAwareAdapter('menu', 3600, dirname(__DIR__) . '/var/cache/pools');
$menuService = new MenuService($userDataService, $cacheMenu);
$application->add(new CacheWarmupMenuCommand($entityManager, $menuService));

// Exécuter la commande
$application->run();
