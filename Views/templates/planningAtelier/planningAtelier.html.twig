{% extends "baseTemplate.html.twig" %}
{% block stylesheets%}
	<link rel="stylesheet" href="{{ App.base_path }}/Views/css/list.css">
	<link rel="stylesheet" href="{{ App.base_path }}/Views/css/planning/planning.css">
{% endblock %}
{% block overlay %}
	<div id="loading-overlay" style="position: fixed;
					                        top: 0;
					                        left: 0;
					                        width: 100%;
					                        height: 100%;
					                        background-color: rgba(0, 0, 0, 0.7);
					                        display: flex;
					                        flex-direction: column;
					                        row-gap: 20px;
					                        align-items: center;
					                        justify-content: center;
					                        z-index: 9999;">
					        <div class="spinner-overlay"></div>
					        <div class="text-overlay text-white">Veuillez patienter s'il vous plaît!</div>
					    </div>
{% endblock %}
{% block content %}
	<div class="sticky-header-titre">
		<div class="container">
			<h3 class="perso-titre">
				Planning Atelier
			</h3>
			{% include "/planningAtelier/_formulaire.html.twig" %}
		</div>
	</div>
	<table class="table rounded table-plein-ecran ">
		<thead class="table-dark position-sticky align-middle">
			<tr>
				<th rowspan="2">Section</th>
				<th rowspan="2">Intitulé Travaux</th>
				<th rowspan="2">numOR</th>
				<th rowspan="2">Itv</th>
				<th rowspan="2">Ressource</th>
				<th rowspan="2">Nb jour</th>
				{% for date in dates %}
					<th colspan="2">{{ date|date('l d/m') }}</th>
				{% endfor %}
			</tr>
			<tr>
				{% for date in dates %}
					<th>mtn</th>
					<th>apm</th>
				{% endfor %}
			</tr>
		</thead>
		<tbody id="tableBody">
			{% for row in planning %}
				<tr>
					<td>{{row.section}}</td>
					<td>{{row.intitule}}</td>
					<td>{{row.numor}}</td>
					<td>{{row.itv}}</td>
					<td>{{row.ressource}}</td>
					<td>{{row.nbjour}}</td>
					{% for date in dates %}
						{% set dateStr = date|date('Y-m-d') %}
						{% set matin_debut = dateStr ~ ' 08:00:00' %}
						{% set matin_fin   = dateStr ~ ' 12:00:00' %}
						{% set aprem_debut = dateStr ~ ' 13:30:00' %}
						{% set aprem_fin   = dateStr ~ ' 17:30:00' %}

						{# Matin : vérifie s'il y a chevauchement avec une des périodes de dateData #}
						{# Après-midi : même logique #}
						{% set aprem_found = false %}
						{% set matin_found = false %}

						{% for periode in row.dateData %}
							{% if periode.datefin >= matin_debut and periode.datedebut < matin_fin %}
								{% set matin_found = true %}
							{% endif %}
							{% if periode.datefin >= aprem_debut and periode.datedebut < aprem_fin %}
								{% set aprem_found = true %}
							{% endif %}
						{% endfor %}
						<td {% if matin_found %}style="background:yellow;"{% endif %}></td>
						<td {% if aprem_found %}style="background:yellow;"{% endif %}></td>
					{% endfor %}
					
				</tr>
			{% endfor %}
		</tbody>
	</table>
{% endblock %}
{% block javascript %}
	<script script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
	<script src="{{ App.base_path }}/Views/js/planningAtelier/semaine.js" type="module"></script>
	<script src="{{ App.base_path }}/Views/js/planningAtelier/planningPositionSticky.js" type="module"></script>
{% endblock %}
