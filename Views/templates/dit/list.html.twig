{% extends "baseTemplate.html.twig" %}

{% block stylesheets%}
<link rel="stylesheet" href="/Hffintranet/Views/css/list.css">
{% endblock %}

{# {% import "macroForm.html.twig" as form %} #}

{% block content %}
	{# {% include "/partials/_loader.html.twig" %} #}

	<div class="container">
		<h3 class="perso-titre">
			Liste de Demande d'intervention
		</h3>
		{% include "/partials/_notification.html.twig" %}

		{% include "/dit/_formulaireRecherche.html.twig" %}
	</div>

	<div
		class="container-fluid">
		<!-- DEBUT tableau -->
		{% if empty == true %}
			<div class="container">
				{% include "/partials/_noResultList.html.twig" %}
			</div>
		{% else %}
			<div class="container">
				<div class="d-flex justify-content-between">
					<div>
						{# Bouton EXCEL#}
						<a href="{{path("export_excel")}}" id="excelDit" name="excelBadm" class="btn btn bg-success text-white my-3 fw-bold">
							<i class="fas fa-table"></i>
							Excel</a>
					</div>
					<div>
						<p class="fw-bold my-3" id="nombreResultat">{{resultat}}
							Resultats</p>
					</div>
					<div>
						<p class="fw-bold my-3" id="nombreResultat">{{currentPage ~' / '~ (totalPages)}}
							pages</p>
					</div>
					<div class="navigation">
						{% set queryParams = criteria  %}

						{% if currentPage > 1 %}
							<a class="btn btn-dark my-3" href="{{ path('dit_index', queryParams|merge({'page': currentPage - 1})) }}">
								<i class="fas fa-angle-left text-warning"></i>
							</a>
						{% endif %}


						{% if currentPage < totalPages %}
							<a class="btn btn-dark" href="{{ path('dit_index', queryParams|merge({'page': currentPage + 1})) }}">
								<i class="fas fa-angle-right text-warning"></i>
							</a>
						{% endif %}
					</div>
				</div>
			</div>

			<table class="table rounded table-plein-ecran">
				<thead class="table-dark">
					<tr>
						<th>
							<i class="fas fa-ellipsis-vertical"></i>
						</th>
						<th>Statut</th>
						<th>N° DIT</th>
						<th>type Document</th>
						<th>Niveau</th>
						<th>Categories</th>
						<th>N° Serie</th>
						<th>N° Parc</th>
						<th>Date Demande</th>
						<th>Int/Ext</th>
						<th>Emetteur</th>
						<th>Débiteur</th>
						<th>Objet</th>
						<th>Section affectée</th>
						<th>N° Or</th>
						<th class="fw-bold">Statut Or</th>

						<th>Statut Livraison Pièces</th>
						<th>Statut Achats Locaux</th>
						<th>Utilisateur</th>
					</tr>
				</thead>
				<tbody>
					{% for item in data %}
						<tr>
							{# Début Action #}
							<td class="align-middle" style="padding: 0px">
								<div class="dropdown">
									<button class="btn btn-sm me-1 dropdown-toggle trois-points-vertical" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
										<i class="fas fa-ellipsis-vertical"></i>
									</button>
									<ul class="dropdown-menu dropdown-menu-end" id="dropdown-menu" aria-labelledby="dropdownMenuButton" style="">

										<li>
											<a class="dropdown-item fw-bold" href="{{ path("dit_duplication", {id: item.id, numDit: item.numeroDemandeIntervention})}}">Dupliquer</a>
										</li>
									</ul>
								</div>
							</td>
							{# Fin Actions #}

							{# DEBUT Statut #}
							{% if item.idStatutDemande.description | trim == 'A AFFECTER' %}
								<td class="bg-warning bg-gradient fw-bold text-cente">
									{{item.idStatutDemande.description | trim}}</td>
							{% elseif item.idStatutDemande.description | trim == 'AFFECTEE SECTION'  %}
								<td class="bg-success bg-gradient fw-bold">{{item.idStatutDemande.description | trim}}</td>
							{% else %}
								<td>{{item.idStatutDemande.description | trim}}</td>
							{% endif %}
							{# FIN Statut #}

							<td>
								<a href="{{ path("dit_validationDit", {id: item.id, numDit: item.numeroDemandeIntervention})}}" target="_blank">{{ item.numeroDemandeIntervention }}</a>
							</td>
							<td>{{ item.typeDocument.description}}</td>
							<td>{{ item.idNiveauUrgence.description}}</td>
							<td>{{item.categorieDemande.libelleCategorieAteApp}}</td>

							{% if item.idMateriel not in idMat %}
								<td>
									-
								</td>
								<td>
									-
								</td>
							{% else %}
								{% for num in numSerieParc %}
									{% if item.idMateriel == num.num_matricule %}
										<td>{{ num.num_serie}}</td>
										<td>{{ num.num_parc}}</td>
									{% endif %}
								{% endfor %}
							{% endif %}

							<td>{{ item.dateDemande|date('d/m/Y')}}</td>
							<td>{{ item.internetExterne}}</td>
							<td>{{ item.agenceServiceEmetteur }}</td>
							<td>{{ item.agenceServiceDebiteur}}</td>
							<td>{{ item.objetDemande}}</td>
							{% set mots_a_supprimer = ['Chef section', 'Chef de section', 'Responsable section '] %}
							<td>{{ item.sectionAffectee | remove_words(mots_a_supprimer)}}</td>
							<td>
								{% if item.numeroOr != '' %}
									<a href="#" data-bs-toggle="modal" data-bs-target="#listeCommande" data-id="{{item.numeroOr}}" id="numOr">{{ item.numeroOr}}</a>
								{% endif %}
							</td>
							<td class="fw-bold fst-italic">{{ item.statutOr}}</td>
							<td>{{ item.statutachatpiece}}</td>
							<td>{{ item.statutachatlocaux}}</td>
							<td>{{item.utilisateurDemandeur}}</td>
						</tr>
					{% endfor %}
				</tbody>
			</table>
		{% endif %}
	</div>

	<!-- FIN tableau -->
	{# body modal #}
	{% include "/dit/_modal.html.twig"  %}
{% endblock %}
{% block javascript %}
	<script script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
	<script src="/Hffintranet/Views/js/dit/listDit.js" type="module"></script>
{% endblock %}
