{% extends "baseTemplate.html.twig" %}
{% block title %}Soumission BC magasin
{% endblock %}
{% block stylesheets %}
	<link href="{{ App.base_path }}/Views/css/new.css?v=2025.10.22.08.00" rel="stylesheet"/>
	<link href="{{ App.base_path }}/Views/css/magasin/devis/soumission.css?v=2025.10.22.08.00" rel="stylesheet"/>
{% endblock %}
{% block content %}
	<div class=" container mt-6">
		<div class="card">
			<div class="card-body">

				<div class="container">
					<div class="row">
						<div class="col-12 col-md-11"></div>
						<div class=" col-12 col-md-1">
							<a href="{{ path("devis_magasin_pol_liste")}}" class="tablinks p-2 btn btn-outline-warning " style="text-decoration: none;color:black">Retour</a>
						</div>
					</div>

					{{ form_start(form, {'attr': {'enctype': 'multipart/form-data', 'id': 'upload-form'}}) }}
					{{ form_errors(form)}}
					<div class="row">
						<div class="col-12 col-md-3">
							{{ form_row(form.numeroDevis) }}
						</div>
						<div class="col-12 col-md-3">
							{{ form_row(form.numeroBc) }}
						</div>
						<div class="col-12 col-md-3">
							{{ form_row(form.dateBc) }}
						</div>
						<div class="col-12 col-md-3">
							{{ form_row(form.montantBc) }}
						</div>
					</div>


					<div class="row">
						<div class="col-12 col-md-3">
							<p>Veuillez insérer
								<strong>le BC client *</strong>
							</p>
							{% include '/partials/_dropZoneFile.html.twig' with {'id': '1', 'form': form, 'fieldName': 'pieceJoint01'} %}
						</div>

						<div class="col-12 col-md-3">
							<p>Insérer
								<strong>les autres fichiers ici</strong>
							</p>
							{% include '/partials/_dropZoneFileMultiple.html.twig' with {'id': '2', 'form': form, 'fieldName': 'pieceJoint2'} %}
						</div>
					</div>

					<div class="row">
						{{ form_row(form.observation) }}
					</div>
					<div class="row table-container d-none">
						<table class="styled-table">
							<thead>
								<tr>
									<th>N° Ligne</th>
									<th>Constructeur</th>
									<th>Référence</th>
									<th>Désignation</th>
									<th>Qté</th>
									<th>Prix HT</th>
									<th>Montant net</th>
									<th>%Remise 1</th>
									<th>%Remise 2</th>
									<th>R.A.S</th>
									<th>Qté à modifier</th>
									<th>Ligne à supprimer</th>
								</tr>

							</thead>
							<tbody>
								{% for ligneForm in form.lignes %}
									{% set ligneData = ligneForm.vars.data %}
									<tr class="border-bottom" id="row-{{ ligneData.numeroLigne }}">
										<td>{{ ligneData.numeroLigne }}</td>
										<td class="text-center">{{ ligneData.constructeur }}</td>
										<td>{{ ligneData.ref }}</td>
										<td>{{ ligneData.designation }}</td>
										<td class="text-center">{{ ligneData.qte }}</td>
										<td>{{ ligneData.prixHt|number_format(2, ',', '.') }}</td>
										<td>{{ ligneData.montantNet|number_format(2, ',', '.') }}</td>
										<td>{{ ligneData.remise1|number_format(2, ',', '.') }}</td>
										<td>{{ ligneData.remise2|number_format(2, ',', '.') }}</td>
										<td>
											<div class="checkbox-container">
												{{ form_widget(ligneForm.ras, {'attr': {'data-numero-ligne': ligneData.numeroLigne}}) }}
											</div>
										</td>
										<td>
											<div class="checkbox-container ">
												{{ form_widget(ligneForm.qteModifier, {'attr': {'data-numero-ligne': ligneData.numeroLigne}}) }}
												{{ form_widget(ligneForm.nouvelleQte) }}
												<span id="qty-status-{{ ligneData.numeroLigne }}" class="status-badge" style="display: none;"></span>
											</div>
										</td>
										<td>
											<div class="checkbox-container">
												{{ form_widget(ligneForm.supprimer, {'attr': {'data-numero-ligne': ligneData.numeroLigne}}) }}
											</div>
										</td>
										{{ form_widget(ligneForm.numeroLigne) }}
									</tr>
								{% endfor %}
							</tbody>
						</table>
					</div>
					<div class="d-flex justify-content-end">
						<button type="submit" class="btn bouton mt-2" id="btn-enregistre-devis" data-confirmation data-form="#upload-form" data-confirmation-text="Vous êtes en train de soumettre le Bc client pour validation">
							<i class="fas fa-save"></i>
							Enregistrer
						</button>
					</div>
					{{ form_end(form) }}
				</div>
			</div>
		</div>
		<div
			id="file-viewer" class="mt-3">
			<!-- Onglets -->
			<ul class="nav nav-tabs" id="pdfTabs" role="tablist">
				<li class="nav-item" role="presentation">
					<button class="nav-link active" id="tab1-tab" data-bs-toggle="tab" data-bs-target="#tab1" type="button" role="tab">
						BC client
					</button>
				</li>
				<li class="nav-item" role="presentation">
					<button class="nav-link" id="tab2-tab" data-bs-toggle="tab" data-bs-target="#tab2" type="button" role="tab">
						Autres fichiers
					</button>
				</li>
			</ul>

			<!-- Contenu des onglets -->
			<div
				class="tab-content border border-top-0 p-3" id="pdfTabContent">
				<!-- Tab 1 -->
				<div class="tab-pane fade show active" id="tab1" role="tabpanel" aria-labelledby="tab1-tab">
					<div id="file-list-1" class="mt-3"></div>
				</div>
				<!-- Tab 2 -->
				<div class="tab-pane fade" id="tab2" role="tabpanel" aria-labelledby="tab2-tab">
					<div id="file-list-2" class="mt-3"></div>
				</div>
			</div>
		</div>
	</div>
{% endblock %}

{% block javascript %}
	<script type="module" src="{{ App.base_path }}/Views/js/magasin/bc/soumission.js?v=2025.10.22.08.00"></script>
{% endblock %}
