{% import "partials/_menu_item.html.twig" as menu_item %}

{% set items = breadcrumbs() %}
<nav aria-label="Fil d'Ariane" class="breadcrumb-nav container">
	<ol class="breadcrumb align-items-center">
		{% for item in items %}
			<li class="breadcrumb-item {% if item.is_active %}active{% endif %} position-relative {% if item.dropdown is defined and item.dropdown|length > 0 %}dropdown-hover{% endif %}">
				{% if item.link and not item.is_active %}
					<a href="{% if item.link is not null and (item.link == '#' or item.link starts with 'http' or item.link starts with '/') %}{{ item.link }}{% elseif item.link is not null and item.routeParams is defined %}{{ path(item.link, item.routeParams) }}{% elseif item.link is not null %}{{ path(item.link) }}{% else %}#{% endif %}" class="breadcrumb-link">
						{% if item.icon %}
							<i class="{{ item.icon }} me-1"></i>
						{% endif %}
						{{ item.title }}
					</a>
				{% else %}
					<span class="breadcrumb-text">
						{% if item.icon %}
							<i class="{{ item.icon }} me-1"></i>
						{% endif %}
						{{ item.title }}
					</span>
				{% endif %}

				{% if item.dropdown is defined and item.dropdown|length > 0 %}
					<i class="fas fa-chevron-down ms-1 small text-muted dropdown-indicator"></i>
					<div class="dropdown-menu">
						<div class="dropdown-grid" style="--col-count: 1;">
							<div class="dropdown-column">
								<div class="dropdown-header">
									<i class="fas fa-list me-2"></i>
									{{ item.title }}
								</div>
								{% for subitem in item.dropdown %}
									<a class="dropdown-item {% if subitem.is_active %}active{% endif %}" href="{% if subitem.link is not null and (subitem.link == '#' or subitem.link starts with 'http' or subitem.link starts with '/') %}{{ subitem.link }}{% elseif subitem.link is not null and subitem.routeParams is defined %}{{ path(subitem.link, subitem.routeParams) }}{% elseif subitem.link is not null %}{{ path(subitem.link) }}{% else %}#{% endif %}" {% if subitem.id %} data-bs-toggle="modal" data-bs-target="#{{ subitem.id }}" {% endif %}>
										{% if subitem.icon %}
											<i class="{{ subitem.icon }} me-2"></i>
										{% endif %}
										{{ subitem.title }}
									</a>
								{% endfor %}
							</div>
						</div>
					</div>
				{% endif %}
			</li>

			{% if not loop.last %}
				<li class="breadcrumb-separator">
					<i class="fas fa-chevron-right text-muted small"></i>
				</li>
			{% endif %}
		{% endfor %}
	</ol>
</nav>

<!-- Modals pour les éléments de dropdown avec ID -->
{% for item in items %}
	{% if item.dropdown is defined %}
		{% for subitem in item.dropdown %}
			{% if subitem.id and subitem.items|length > 0 %}
				<!-- Modal pour {{ subitem.title }} -->
				<div class="modal fade" id="{{ subitem.id }}" tabindex="-1" aria-labelledby="{{ subitem.id }}Label" aria-hidden="true">
					<div class="modal-dialog modal-dialog-centered modal-lg">
						<div class="modal-content">
							<div class="modal-header">
								<h5 class="modal-title" id="{{ subitem.id }}Label">
									{% if subitem.icon %}
										<i class="{{ subitem.icon }} me-2"></i>
									{% endif %}
									{{ subitem.title }}
								</h5>
								<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
							</div>
							<div class="modal-body">
								{% set itemsPerColumn = 2 %}
								{% set totalItems = subitem.items|length %}
								{% set columnsNeeded = totalItems > 0 ? (totalItems / itemsPerColumn)|round(0, 'ceil') : 1 %}

								<div class="row">
									{% for column in 1..columnsNeeded %}
										<div class="col-md-{{ 12 // columnsNeeded }}">
											<ul class="list-group list-group-flush">
												{% for modalItem in subitem.items|slice((column - 1) * itemsPerColumn, itemsPerColumn) %}
													{% if modalItem.subitems is defined and modalItem.subitems|length > 0 %}
														<!-- Groupe avec sous-éléments -->
														{{ menu_item.render(modalItem) }}
														{% for subsubitem in modalItem.subitems %}
															{{ menu_item.render(subsubitem, true) }}
														{% endfor %}
													{% else %}
														<!-- Élément simple -->
														{{ menu_item.render(modalItem) }}
													{% endif %}
												{% endfor %}
											</ul>
										</div>
									{% endfor %}
								</div>
							</div>
						</div>
					</div>
				</div>
			{% endif %}
		{% endfor %}
	{% endif %}
{% endfor %}
