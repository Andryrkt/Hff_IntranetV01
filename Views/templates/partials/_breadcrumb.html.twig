{% import "partials/_menu_item.html.twig" as menu_item %}

{% set items = breadcrumbs() %}

<nav id="fil-d-ariane" aria-label="Fil d'Ariane" class="breadcrumb-nav container-fluid">
	<ol class="breadcrumb flat align-items-center mb-3">
		{% for item in items %}
			{# Seul l'Accueil a un dropdown — les autres items sont de simples textes #}
			{% set hasDropdown = item.dropdown is defined and item.dropdown|length > 0 %}

			<li class="breadcrumb-item {{ item.is_active ? 'active' }} position-relative dropdown-hover">

				{% if item.is_active %}
					{# Page courante : texte simple, non cliquable #}
					<span class="breadcrumb-text">
						{% if item.icon %}
							<i class="{{ item.icon }} me-1"></i>
						{% endif %}
						{{ item.title }}
					</span>

				{% elseif hasDropdown %}
					{# Accueil : lien cliquable + dropdown qui ouvre les modals #}
					<a href="{{ item.link }}" class="breadcrumb-link d-flex align-items-center">
						{% if item.icon %}
							<i class="{{ item.icon }} me-1"></i>
						{% endif %}
						{{ item.title }}
					</a>
					{% set columnsNeeded = (item.dropdown|length / 6)|round(0, 'ceil') %}
					<div class="dropdown-menu shadow-sm p-2 rounded-3" style="min-width: {{ columnsNeeded * 220 }}px;">
						<div class="row">
							{% for column in 1..columnsNeeded %}
								<div class="col-md-{{ 12 // columnsNeeded }}">
									{% for subitem in item.dropdown|slice((column - 1) * 6, 6) %}
										<a class="dropdown-item d-flex align-items-center" href="#" data-bs-toggle="modal" data-bs-target="#{{ subitem.id }}">
											{% if subitem.icon %}
												<i class="{{ subitem.icon }} me-2 text-secondary"></i>
											{% endif %}
											{{ subitem.title }}
										</a>
									{% endfor %}
								</div>
							{% endfor %}
						</div>
					</div>

				{% else %}
					{# Module / sous-menu intermédiaire : texte sans lien #}
					<span class="breadcrumb-text d-flex align-items-center">
						{% if item.icon %}
							<i class="{{ item.icon }} me-1"></i>
						{% endif %}
						{{ item.title }}
					</span>
				{% endif %}

			</li>

			{% if not loop.last %}
				<li class="breadcrumb-separator"></li>
			{% endif %}
		{% endfor %}
	</ol>
</nav>

{# Modals — identiques à ceux de la page d'accueil, générés depuis le dropdown Accueil #}
{% set accueil = items|first %}
{% if accueil.dropdown is defined %}
	{% for module in accueil.dropdown %}
		<div class="modal fade" id="{{ module.id }}" tabindex="-1" aria-labelledby="{{ module.id }}Label" aria-hidden="true">
			<div class="modal-dialog modal-dialog-centered modal-xl menu">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="{{ module.id }}Label">
							{% if module.icon %}
								<i class="{{ module.icon }} me-2"></i>
							{% endif %}
							{{ module.title }}
						</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
					</div>
					<div class="modal-body">
						<div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-3">
							{% for modalItem in module.items %}
								<div class="col">
									<ul class="list-group list-group-flush h-100">
										{% if modalItem.subitems is defined and modalItem.subitems|length > 0 %}
											<!-- Groupe avec sous-éléments -->
											{{ menu_item.render(modalItem) }}
											{% for subsubitem in modalItem.subitems %}
												{{ menu_item.render(subsubitem, true) }}
											{% endfor %}
										{% else %}
											<!-- Élément simple -->
											{{ menu_item.render(modalItem) }}
										{% endif %}
									</ul>
								</div>
							{% endfor %}
						</div>
					</div>
				</div>
			</div>
		</div>
	{% endfor %}
{% endif %}
